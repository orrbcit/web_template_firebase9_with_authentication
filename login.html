<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Auth</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light d-flex align-items-center" style="min-height:100vh;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-sm-10 col-md-6 col-lg-4">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h1 class="h4 mb-3 text-center">Welcome</h1>

                        <!-- Alerts -->
                        <div id="alert" class="alert d-none" role="alert"></div>

                        <!-- Login form -->
                        <form id="loginForm" novalidate>
                            <div class="mb-3">
                                <label for="loginEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="loginEmail" placeholder="you@example.com"
                                    required>
                            </div>
                            <div class="mb-2">
                                <label for="loginPassword" class="form-label">Password</label>
                                <input type="password" class="form-control" id="loginPassword" placeholder="••••••••"
                                    required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 mt-2">Log In</button>
                            <div class="text-center mt-3">
                                <small class="text-muted">Don’t have an account?
                                    <a href="#" id="toSignup">Signup?</a>
                                </small>
                            </div>
                        </form>

                        <!-- Signup form (hidden by default) -->
                        <form id="signupForm" class="d-none" novalidate>
                            <div class="mb-3">
                                <label for="signupName" class="form-label">Name</label>
                                <input type="text" class="form-control" id="signupName" placeholder="Your name"
                                    required>
                            </div>
                            <div class="mb-3">
                                <label for="signupEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="signupEmail" placeholder="you@example.com"
                                    required>
                            </div>
                            <div class="mb-2">
                                <label for="signupPassword" class="form-label">Password</label>
                                <input type="password" class="form-control" id="signupPassword"
                                    placeholder="At least 6 characters" required>
                            </div>
                            <button type="submit" class="btn btn-success w-100 mt-2">Create Account</button>
                            <div class="text-center mt-3">
                                <small class="text-muted">Already have an account?
                                    <a href="#" id="toLogin">Back to login</a>
                                </small>
                            </div>
                        </form>

                    </div>
                </div>
                <p class="text-center mt-3 text-muted small">Firebase v9 • Bootstrap 5</p>
            </div>
        </div>
    </div>

    <!-- Firebase v9 (modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getAuth,
            setPersistence,
            browserLocalPersistence,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        // TODO: replace with your own config
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyC77-kjyMkMzydjO9iVBQkecBjiS2Y0nuA",
            authDomain: "project-7818613190886662832.firebaseapp.com",
            projectId: "project-7818613190886662832",
            storageBucket: "project-7818613190886662832.firebasestorage.app",
            messagingSenderId: "309340311041",
            appId: "1:309340311041:web:04864f9e800f054bdafa00",
            measurementId: "G-MRL3NL9FJ8"
        };

        // Init
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        // Stay logged in across tabs/browser restarts
        await setPersistence(auth, browserLocalPersistence);

        // UI elements
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const toSignup = document.getElementById('toSignup');
        const toLogin = document.getElementById('toLogin');
        const alertBox = document.getElementById('alert');

        const show = (el) => el.classList.remove('d-none');
        const hide = (el) => el.classList.add('d-none');

        function toggleForms(showSignup) {
            if (showSignup) {
                hide(loginForm); show(signupForm);
            } else {
                hide(signupForm); show(loginForm);
            }
            hide(alertBox);
        }

        toSignup.addEventListener('click', (e) => { e.preventDefault(); toggleForms(true); });
        toLogin.addEventListener('click', (e) => { e.preventDefault(); toggleForms(false); });

        function showAlert(msg, type = 'danger') {
            alertBox.className = `alert alert-${type}`;
            alertBox.textContent = msg;
            show(alertBox);
        }

        function redirect() {
            // Redirect after successful auth
            window.location.href = "main.html";
        }

        // Handle Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                redirect();
            } catch (err) {
                // Friendly messages for common cases
                const map = {
                    'auth/invalid-email': 'That email looks invalid.',
                    'auth/user-disabled': 'This account has been disabled.',
                    'auth/user-not-found': 'No account found. Try “Signup?” below.',
                    'auth/wrong-password': 'Incorrect password. Try again.'
                };
                showAlert(map[err.code] || err.message);
            }
        });

        // Handle Signup
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;

            if (name.length < 2) {
                showAlert('Please enter your name.');
                return;
            }
            try {
                const cred = await createUserWithEmailAndPassword(auth, email, password);
                // Save displayName on the user profile
                await updateProfile(cred.user, { displayName: name });
                redirect();
            } catch (err) {
                const map = {
                    'auth/email-already-in-use': 'Email already in use. Try logging in.',
                    'auth/invalid-email': 'That email looks invalid.',
                    'auth/weak-password': 'Password should be at least 6 characters.'
                };
                showAlert(map[err.code] || err.message);
            }
        });
    </script>
</body>

</html>